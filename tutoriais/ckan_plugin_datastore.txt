# Log as root
sudo su

# Activating plugin
sed -i 's/ckan.plugins = /ckan.plugins = datastore /g' /etc/ckan/default/development.ini

# Set-up the database
su postgres
createuser -S -D -R -P -l datastore_default
createdb -O ckan_default datastore_default -E utf-8
exit

# Set-up database configuration access
nano /etc/ckan/default/development.ini
    # Edit lines:
    | ckan.datastore.write_url = postgresql://ckan_default:pass@localhost/datastore_default
    | ckan.datastore.read_url = postgresql://datastore_default:pass@localhost/datastore_default

# Set permissions
su -s /bin/bash - ckan
. /usr/lib/ckan/default/bin/activate
paster --plugin=ckan datastore set-permissions -c /etc/ckan/default/development.ini > /etc/ckan/default/_plugin_datastore.sql
exit
su postgres
cat /etc/ckan/default/_plugin_datastore.sql | psql --set ON_ERROR_STOP=1
exit


# Start server
. /usr/lib/ckan/default/bin/activate
cd /usr/lib/ckan/default/src/ckan
paster serve /etc/ckan/default/development.ini

# Test the set-up
# IMPORTANT! You need to start the server
# If you get "success": true, so all work ok
curl -X GET "http://127.0.0.1:5000/api/3/action/datastore_search?resource_id=_table_metadata"
